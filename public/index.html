<html>
<head>
    <title>Snake Scripting Challenge</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="/static/bootstrap/css/bootstrap.css" rel="stylesheet">
    <link href="/static/bootstrap/css/bootstrap-responsive.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="/static/css/main.css"/>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
    <script src="/static/bootstrap/js/bootstrap.min.js"></script>
    <script src="http://www.parsecdn.com/js/parse-1.2.8.min.js"></script>
    <script src="/static/js/knockout-2.2.1.js"></script>
    <script src="/static/codemirror-3.14/lib/codemirror.js"></script>
    <link rel="stylesheet" href="/static/codemirror-3.14/lib/codemirror.css">
    <link rel="stylesheet" href="/static/codemirror-3.14/addon/lint/lint.css">
    <script src="/static/codemirror-3.14/mode/javascript/javascript.js"></script>
    <script src="/static/codemirror-3.14/addon/lint/lint.js"></script>
    <script src="/static/codemirror-3.14/addon/lint/javascript-lint.js"></script>
    <script src="/static/codemirror-3.14/addon/hint/javascript-hint.js"></script>
    <script type="text/javascript" src="/static/js/common.js"></script>
    <script type="text/javascript" src="/static/js/user.js"></script>
    <script type="text/javascript" src="/static/js/game.js"></script>
</head>
<body id="singleplayer">
<div id="fb-root"></div>
<script>
    window.fbAsyncInit = function () {
        Parse.FacebookUtils.init({
            appId: '550911944955409', // Facebook App ID
            channelUrl: '//snake-challenge.parseapp.com/channel.html', // Channel File
            cookie: true, // enable cookies to allow Parse to access the session
            xfbml: true  // parse XFBML
        });
    };

    // Load the SDK asynchronously
    (function (d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) {
            return;
        }
        js = d.createElement(s);
        js.id = id;
        js.src = "//connect.facebook.net/en_US/all.js";
        fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));
</script>
<div class="container-fluid">
    <div class="navbar">
        <div class="navbar-inner">
            <a class="brand active" href="/">Snake Scripting Challenge</a>
            <ul class="nav">
                <li><a href="/leaderboard.html">Leaderboard</a></li>
                <li><a href="/multiplayer.html">Multiplayer</a></li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="#" data-bind="click: $root.login.bind($root), visible: !user()">Login</a></li>
                <li><a href="#" data-bind="click: $root.logout.bind($root), visible: user">Logout</a></li>
            </ul>
        </div>
    </div>
    <div class="row-fluid">
        <div class="span3">
            <canvas id="board" width="320" height="240"></canvas>
            <div class="btn-group">
                <button class="btn btn-primary" data-bind="click: $root.start.bind($root)">Start!</button>
                <button class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
                    <span class="caret"></span>
                </button>
                <ul class="dropdown-menu">
                    <li>
                        <label>Game Speed: <span data-bind="text: speed"></span></label>
                        <input class="fps-control" type="range" min="1" max="60" data-bind="value: speed">
                    </li>
                    <li class="divider"></li>
                    <li>
                        <div class="input-append">
                            <input class="span4" type="number" data-bind="value: movesToSkip" onclick="event.stopPropagation();">
                            <button class="btn" data-bind="click: $root.skipMoves.bind($root)">Skip Moves</button>
                        </div>
                    </li>
                </ul>
            </div>
            <button class="btn" data-bind="click: $root.setCode.bind($root)">Set Script</button>
            <div class="progress" data-bind="visible: showSkipProgress">
                <div class="bar" data-bind="style: { width: skipProgress() + '%' }"></div>
            </div>
            <table class="table table-striped table-condensed" data-bind="with: game">
                <tbody>
                <tr>
                    <td>Direction</td>
                    <td class="text-right"><span data-bind="text: direction"></span></td>
                </tr>
                <tr>
                    <td>Board Size</td>
                    <td class="text-right">40 x 30</td>
                </tr>
                <tr>
                    <td>Head</td>
                    <td class="text-right"><span data-bind="text: head"></span></td>
                </tr>
                <tr>
                    <td>Food</td>
                    <td class="text-right"><span data-bind="text: food"></span></td>
                </tr>
                <tr>
                    <td>Moves</td>
                    <td class="text-right"><span data-bind="text: moves"></span></td>
                </tr>
                <tr>
                    <td>Food Eaten</td>
                    <td class="text-right"><span data-bind="text: eaten"></span></td>
                </tr>
                <tr>
                    <td>Score</td>
                    <td class="text-right"><span data-bind="text: score"></span></td>
                </tr>
                <tr>
                    <td>Snake Length</td>
                    <td class="text-right"><span data-bind="text: length"></span></td>
                </tr>
                <tr>
                    <td>% Complete</td>
                    <td class="text-right"><span data-bind="text: percentComplete"></span></td>
                </tr>
                </tbody>
            </table>
        </div>
        <div class="span9">
            <div class="code-header">
                <h4>Your script</h4>
                <span class="pull-right">Check out the <a href="#api" data-toggle="modal">API Documentation</a> to get started!</span>
            </div>
            <div id="login-alert" class="alert alert-info" data-bind="visible: showLoginAlert" style="display: none;">
                <button type="button" class="close" data-dismiss="alert">×</button>
                <strong>Heads Up!</strong> You must login via Facebook to save script on server and compete in the leaderboards. <a href="#" data-bind="click: login">Click Here</a> to login.
            </div>
            <textarea class="code-input" id="code-input" rows="25"></textarea>
        </div>
    </div>
    <div id="api" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
         aria-hidden="true">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            <h3>API Documentation</h3>
        </div>
        <div class="modal-body">
            <h3>Overview</h3>
            <p>Your code <strong>must</strong> be in the following syntax in order to work:</p>
            <pre>
function() {
    return LEFT; // Can also be RIGHT, UP, and DOWN
}
            </pre>
            <p>Keep all code in a single anonymous function (inner functions are allowed).</p>
            <p>If your code returns an invalid direction (including inverse directions), your snake will continue in the current direction.</p>
            <p>You have access to the <em>self</em> variable to save state between moves, as well as access to game state.</p>
            <pre>
function() {
   self.myLastMove = LEFT;
   return self.myLastMove;
}
            </pre>
            <p>All built-in game state variables (other than direction) are backed up prior, and restored after, your function is called.  This prevents tampering.</p>
            <h3>Constants</h3>
            <pre>
var BOARD_WIDTH = 40;
var BOARD_HEIGHT = 30;
var BOARD_SIZE = BOARD_WIDTH * BOARD_HEIGHT;

var UP = 'up';
var LEFT = 'left';
var RIGHT = 'right';
var DOWN = 'down';

var inverseDirection = {
    'up': 'down',
    'left': 'right',
    'right': 'left',
    'down': 'up'
};
            </pre>
            <h3>Properties</h3>
            <dl>
                <dt>self.eaten</dt>
                <dd>An integer indicating the amount of food eaten before the next move</dd>
                <dt>self.moves</dt>
                <dd>An integer indicating the number of moves taken before the next move</dd>
                <dt>self.head_x</dt>
                <dd>An integer indicating the snake head's x position</dd>
                <dt>self.head_y</dt>
                <dd>An integer indicating the snake head's y position</dd>
                <dt>self.direction</dt>
                <dd>A string indicating the snake's direction during the previous move</dd>
                <dt>self.snake_sections</dt>
                <dd>An array of strings indicating the snake's currently occupied positions, in the format ["(x, y)", "(x, y)"]</dd>
                <dt>self.food_x</dt>
                <dd>An integer indicating the food x position</dd>
                <dt>self.food_y</dt>
                <dd>An integer indicating the food y position</dd>
            </dl>
            <h3>Functions</h3>
            <dl>
                <dt>self.peekForCollision(direction)</dt>
                <dd>Takes one of the four valid direction constants, and returns a boolean indicating whether or not the next move will result in a collision for the given direction</dd>
            </dl>
        </div>
    </div>
</div>
</body>
<script>
    Parse.initialize("rwqT1Ag7cow4gldZchA3Gr5s3TnDCdmZnxSGAjqP", "MY0rT3SUsR52DnrPHM8vz2YPxq9ZBxuRhaeCQqHe");
    var canvas = document.getElementById("board");
    ko.applyBindings(new SingleGameViewModel(canvas));
</script>
</html>
